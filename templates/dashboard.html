{% extends 'base.html' %}
{% load static %}

{% block title %}IslaHaven — Dashboard{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row gap-8">
  <!-- Left column: Overview -->
  <div class="md:w-2/3 card p-6">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Hello, User</h2>
      <a href="{% url 'booking-view' %}" class="btn-transparent">Manage Bookings</a>
    </div>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="p-4 bg-teal-50 rounded-lg">
        <div class="text-sm text-gray-500">Upcoming Stays</div>
        <div class="mt-2 font-semibold text-xl text-teal-700">{{ upcoming_stays_count|default:0 }}</div>
        {% if upcoming_hotels.0 %}
        <div class="text-xs text-gray-500 mt-1">Next: {{ upcoming_hotels.0.hotel.name }} ({{ upcoming_hotels.0.check_in_date|date:"M d" }})</div>
        {% endif %}
      </div>
      <div class="p-4 bg-blue-50 rounded-lg">
        <div class="text-sm text-gray-500">Ferry Rides</div>
        <div class="mt-2 font-semibold text-xl text-blue-700">{{ ferry_rides_count|default:0 }}</div>
        {% if upcoming_ferry.0 %}
        <div class="text-xs text-gray-500 mt-1">Next: {{ upcoming_ferry.0.departure_date|date:"M d" }}, {{ upcoming_ferry.0.ferry.departure_time|time:"H:i" }}</div>
        {% endif %}
      </div>
      <div class="p-4 bg-yellow-50 rounded-lg">
        <div class="text-sm text-gray-500">Events Booked</div>
        <div class="mt-2 font-semibold text-xl text-yellow-700">{{ events_count|default:0 }}</div>
        {% if upcoming_events.0 %}
        <div class="text-xs text-gray-500 mt-1">{{ upcoming_events.0.event.title }} ({{ upcoming_events.0.event.event_date|date:"M d" }})</div>
        {% endif %}
      </div>
    </div>

    <div class="mt-6">
      <h3 class="font-semibold text-lg">Recent Activity</h3>
      <ul class="mt-3 space-y-3 text-sm text-gray-700">
        {% if recent_bookings.0 %}
        <li class="p-3 bg-gray-50 rounded">
          <a href="{% url 'booking_detail' recent_bookings.0.id %}" class="hover:text-teal-600">
            {{ recent_bookings.0.hotel.name }} — {{ recent_bookings.0.check_in_date|date:"M d" }} to {{ recent_bookings.0.check_out_date|date:"M d" }}
          </a>
        </li>
        {% endif %}
        {% if recent_ferry.0 %}
        <li class="p-3 bg-gray-50 rounded">
          <a href="{% url 'tickets' %}" class="hover:text-teal-600">
            Purchased ferry ticket for {{ recent_ferry.0.ferry.name }} ({{ recent_ferry.0.departure_date|date:"M d" }})
          </a>
        </li>
        {% endif %}
        {% if recent_events.0 %}
        <li class="p-3 bg-gray-50 rounded">
          <a href="{% url 'booking_detail' recent_events.0.booking.id %}" class="hover:text-teal-600">
            Registered for {{ recent_events.0.event.title }}
          </a>
        </li>
        {% endif %}
      </ul>
    </div>
  </div>

  <!-- Right column: Profile & Actions -->
  <aside class="md:w-1/3">
    <div class="card p-6 mb-6">
      <h4 class="font-semibold text-lg">Profile</h4>
      <div class="mt-3">
        <div class="text-sm text-gray-600">Mohamed Afnaan Shifau</div>
        <div class="text-xs text-gray-500">24019736</div>
      </div>
      <a href="{% url 'login' %}" class="mt-4 block btn-secondary w-full">Sign Out</a>
    </div>

    <div class="card p-6">
      <h4 class="font-semibold text-lg">Quick Actions</h4>
      <div class="mt-4 space-y-3">
        <a href="{% url 'rooms' %}" class="btn-primary w-full block py-3">Book Room</a>
        <a href="{% url 'book_ferry' %}" class="btn-primary w-full block py-3">Book Ferry</a>
        <a href="{% url 'events' %}" class="btn-primary w-full block py-3">Book Event</a>
      </div>
    </div>
  </aside>
</div>
{% endblock %}
